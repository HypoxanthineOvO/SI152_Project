# Exact Penalty Subproblem
## Description
$$
g^Tx + \frac{1}{2} x^T H x + \sum_{i\in\mathcal{E}}\vert a_i^Tx+b_i\vert + \sum_{i\in\mathcal{I}}^m \max(0, a_i^Tx + b_i)
$$

## Input
- $g\in\mathbb{R}^n$
- $H\in\mathbb{R}^{n\times n}$
- $a_i\in\mathbb{R}^n, i\in\mathcal{E}\cup \mathcal{I}$
- $b_i\in\mathbb{R}, i\in\mathcal{E}\cup \mathcal{I}$

## Easy Testcase
```lingo
@VARIABLES:
	x1, x2;

MIN = 0.5 * (x1*x1+x2*x2)+x1;

2*x1 + 2*x2 = 3;
x1 <= 4;
x2 <= 2;
```
### QP Problem
- $n=2$
- $H=\begin{bmatrix}1 & 0\\0 & 1\end{bmatrix}, g=\begin{bmatrix}1\\0\end{bmatrix}$
  - $f(x) = x_1  + \frac{1}{2}(x_1^2 + x_2^2)$
- $\mathcal{E}=\{1\}, \mathcal{I}=\{2, 3\}$
- $A = \begin{bmatrix}2 & 2\\1 & 0\\0 & 1\end{bmatrix}, b=\begin{bmatrix}-3\\-4\\-2\end{bmatrix}$
  - $2x_1 + 2 x_2 = 3\quad\bigg(x_1+2x_2+(-3) = 0\bigg)$
  - $x_1\leq 4\quad\bigg(x_1+(-4)\leq 0\bigg)$
  - $x_2\leq 2\quad\bigg(x_2+(-2)\leq 0\bigg)$
### QP Solution(By LINGO)
- Objective value: 1.062500
- x1 = 0.25, x2 = 1.250000
### Exact Penalty Subproblem
```lingo
MIN = 0.5 * (x1*x1+x2*x2)+x1 + @abs(2*x1+2*x2-3) + @smax(x1-4, 0) + @smax(x2-2, 0);
```
优化结果和 QP 问题一致

## Random 2D Testcase
```
n: 2
m: 4
H: [[1.01, 0.0], [0.0, 4.1280538329396157]]
g: [-2.240893199201458, 1.2661185298577784]
AI: [[0.0, 0.0], [1.0808119130554454, 2.5452007784710537], [-0.0, -0.0], [-1.0808119130554454, -2.5452007784710537]]
bI: [-0.7781567509498505, -0.8700121482468192, -0.9797816025596743, -0.167380154452062]
AE: None
bE: None
```

```lingo
MIN = 0.5 * (1.01 * x1 * x1 + 4.1280538329396155 * x2 * x2 ) + (-2.240893199201458 * x1 + 1.2661185298577784 * x2 ) + @smax(0, + -0.7781567509498505)  + @smax(0, 1.0808119130554454 * x1 + 2.5452007784710537 * x2 + -0.8700121482468192)  + @smax(0, + -0.9797816025596743)  + @smax(0, -1.0808119130554454 * x1 + -2.5452007784710537 * x2 + -0.167380154452062) ;
```

### Result
```
Objective value:                             -1.536244
Variable           Value        Reduced Cost
      X1        1.148595           0.6367188E-04
      X2      -0.1927804E-08        3.811319
```

## Mid Dimension Testcase
### Testcase
```
n: 4
m: 8
H: [[4.245543863603787, 1.8732407241094962, 0.0, -0.14077059583392978], [1.8732407241094962, 6.515352280743654, 0.0, 0.2094787493876009], [0.0, 0.0, 0.01, 0.0], [-0.14077059583392978, 0.2094787493876009, 0.0, 0.03074855039277892]]
g: [0.31306770165090136, -0.8540957393017248, -2.5529898158340787, 0.6536185954403606]
AI: [[0.0, 0.0, 0.0, -1.980796468223927], [-1.4543656745987648, 2.2697546239876076, 0.8644361988595057, 0.0], [0.1549474256969163, 0.0, 0.37816251960217356, 0.0], [-0.8877857476301128, 0.04575851730144607, 0.0, 1.469358769900285], [-0.0, -0.0, -0.0, 1.980796468223927], [1.4543656745987648, -2.2697546239876076, -0.8644361988595057, -0.0], [-0.1549474256969163, -0.0, -0.37816251960217356, -0.0], [0.8877857476301128, -0.04575851730144607, -0.0, -1.469358769900285]]
bI: [-0.4663107728563063, -0.24442559200160274, -0.15896958364551972, -0.11037514116430513, -0.7911232439051653, -0.8386904821150037, -0.34689167453460157, -0.7467083974602179]
AE: None
bE: None

```
### LINGO Exact Penalty Subproblem
```lingo
MIN = 0.5 * (4.245543863603787 * x1 * x1 + 1.8732407241094962 * x1 * x2 + -0.14077059583392978 * x1 * x4 + 1.8732407241094962 * x2 * x1 + 6.515352280743654 * x2 * x2 + 0.2094787493876009 * x2 * x4 + 0.01 * x3 * x3 + -0.14077059583392978 * x4 * x1 + 0.2094787493876009 * x4 * x2 + 0.03074855039277892 * x4 * x4 ) + (0.31306770165090136 * x1 + -0.8540957393017248 * x2 + -2.5529898158340787 * x3 + 0.6536185954403606 * x4 ) + @smax(0, -1.980796468223927 * x4 + -0.4663107728563063)  + @smax(0, -1.4543656745987648 * x1 + 2.2697546239876076 * x2 + 0.8644361988595057 * x3 + -0.24442559200160274)  + @smax(0, 0.1549474256969163 * x1 + 0.37816251960217356 * x3 + -0.15896958364551972)  + @smax(0, -0.8877857476301128 * x1 + 0.04575851730144607 * x2 + 1.469358769900285 * x4 + -0.11037514116430513)  + @smax(0, 1.980796468223927 * x4 + -0.7911232439051653)  + @smax(0, 1.4543656745987648 * x1 + -2.2697546239876076 * x2 + -0.8644361988595057 * x3 + -0.8386904821150037)  + @smax(0, -0.1549474256969163 * x1 + -0.37816251960217356 * x3 + -0.34689167453460157)  + @smax(0, 0.8877857476301128 * x1 + -0.04575851730144607 * x2 + -1.469358769900285 * x4 + -0.7467083974602179) ;
```

### Result:
```
Objective value:   -86.37421

Variable           Value        Reduced Cost
      X1       0.2323276          -0.5878077E-03
      X2        0.000000            1.850603
      X3        131.0391          -0.4866184E-05
      X4       0.2177959E-08       0.6209336
```